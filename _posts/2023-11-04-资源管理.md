---
title: Unity 资源管理
date: 2023-11-04 09:00:00 +0000
categories: [Unity, Framework]
tags: [unity, 资源管理, 热更新, 打包]
---

# 资源加载

## 加载API

1. Resources
2. AssetsDatabase
3. AssetBundle
4. WWW
5. UnityWebRequest
6. File

## 常用路径：

1. Application.dataPath
2. Application.streamingAssetsPath
3. Application.persistentDataPath
4. Application.temporaryCachePath

## 加载接口

路径 = 目录 + 资源名 + 资源类型

目录在资源目录表配置

资源名根据不同功能的配表获取

资源类型由底层不同的资源加载接口拼接



根据路径名选择Resources、AssetsBundle、StreamingAssets加载

1. 依次查找不同方式对应目录下的资源
2. 根据配表选择加载方式

## 加载环境

1. 开发阶段
   1. 编辑器加载原生资源
   2. 调试加载打包资源
2. 真机运行
   1. 加载打包资源

# 热更新

## 打包

### 分包策略

首包+启动资源+可选资源

### 打包方式

一个叶子节点目录为一个小包

包名使用相对资源根目录的路径作为包名

### 资源分类

美术资源

程序资源

### 配置文件

1. 首保资源放在resources文件夹下，不参与热更
2. 游戏版本文件
   1. 资源版本号
   2. 资源清单文件url
   3. 引擎版本号
   4. 脚本清单文件url
   5. 资源总大小
3. 启动资源配置文件（资源、脚本资源）
   1. 版本号
   2. 资源大小
   3. 资源列表
      1. 路径
      2. md5
4. 可选资源配置文件（多个）
   1. 与启动资源配置项一致

### 增量打包

对比此次需要打包、之前打包好的版本文件，有差异的重新打包

### 打包工具

Jenkins自动打包

## 下载

### 下载流程

1. 检查网络
2. 请求版本文件
3. 是否强制更新
4. 对比本地版本文件
5. 检查内存是否支持更新
6. 请求资源清单文件
7. 对比资源列表逐项更新

### 断点续传

记录当前下载的比特位置，断网重连后请求该位置继续下载

### 边下边玩

根据上述分包策略实现

## 运行时管理

1. 根据预加载配置，启动时加载到内存
2. bundle引用计数方案
   1. 加载资源和其所有依赖，初始引用值为1
   2. 已经被加载过的资源再次加载调用时，引用+1
   3. 资源销毁时引用-1， 引用值为0时卸载资源，反向查找依赖该资源的资源，引用-1

# 加密

## Lz4

# 资源系统案例



